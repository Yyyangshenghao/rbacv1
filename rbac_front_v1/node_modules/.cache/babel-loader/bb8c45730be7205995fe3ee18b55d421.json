{"remainingRequest":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\babel-loader\\lib\\index.js!E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\src\\views\\face\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\src\\views\\face\\index.vue","mtime":1705145088986},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\babel.config.js","mtime":1705038906658},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1705038908307},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\babel-loader\\lib\\index.js","mtime":1705038907812},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1705038908307},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\vue-loader\\lib\\index.js","mtime":1705038915248}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDYW1lcmFDb21wb25lbnQiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlbXBsb3llZUlkOiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgidXNlcklkIikKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBzZXR1cENhbWVyYSgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgICAgICB2aWRlbzogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHRoaXMuJHJlZnMudmlkZW8uc3JjT2JqZWN0ID0gc3RyZWFtOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFjY2Vzc2luZyB0aGUgY2FtZXJhOicsIGVycm9yKTsKICAgICAgfQogICAgfSwKICAgIGNhcHR1cmVBbmRQcm9jZXNzSW1hZ2UoKSB7CiAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuJHJlZnMuY2FudmFzOwogICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNvbnN0IHZpZGVvID0gdGhpcy4kcmVmcy52aWRlbzsKICAgICAgY29udGV4dC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgICAvLyDlsIblm77lg4/ovazmjaLkuLpCYXNlNjTnvJbnoIHnmoTlrZfnrKbkuLIKICAgICAgbGV0IGJhc2U2NEltYWdlID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7CiAgICAgIC8vIOWOu+mZpEJhc2U2NOWtl+espuS4suS4reeahOWJjee8gAogICAgICBiYXNlNjRJbWFnZSA9IGJhc2U2NEltYWdlLnJlcGxhY2UoL15kYXRhOmltYWdlXC9wbmc7YmFzZTY0LC8sICcnKTsKICAgICAgLy9jb25zb2xlLmxvZyhiYXNlNjRJbWFnZSk7IC8vIOaJk+WNsOWIsOaOp+WItuWPsOaIluWPkemAgeWIsOWQjuerrwoKICAgICAgdGhpcy5zZW5kSW1hZ2VUb0JhY2tlbmQoYmFzZTY0SW1hZ2UpOwogICAgfSwKICAgIGFzeW5jIHNlbmRJbWFnZVRvQmFja2VuZChiYXNlNjRJbWFnZSkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgICAgICAgICBiYXNlNjRJbWFnZTogYmFzZTY0SW1hZ2UsCiAgICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQKICAgICAgICAgIC8vIOWPr+S7pea3u+WKoOWFtuS7lumcgOimgeeahOaVsOaNrgogICAgICAgIH07CgogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kaHR0cC5wb3N0KCcvaW1hZ2UvdXBsb2FkLWltYWdlJywgcGF5bG9hZCk7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAnZmFpbCcpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLm1zZyA9PT0gJ05vIGZhY2UgZGV0ZWN0ZWQgaW4gdGhlIGltYWdlLicpIHsKICAgICAgICAgICAgYWxlcnQoIuacquajgOa1i+WIsOS6uuiEuO+8jOivt+mHjeaWsOaLjeeFp++8gSIpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGVydCgi5LiK5Lyg5oiQ5Yqf77yBIik7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgdGhlIGltYWdlIHRvIGJhY2tlbmQ6JywgZXJyb3IpOwogICAgICB9CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5zZXR1cENhbWVyYSgpOwogIH0KfTs="},{"version":3,"mappings":"AASA;EACAA;EACAC;IACA;MACAC;IACA;EACA;EACAC;IACA;MACA;QACA;UAAAC;QAAA;QACA;MACA;QACAC;MACA;IACA;IACAC;MACA;MACA;MACA;MACAC;;MAEA;MACA;MACA;MACAC;MACA;;MAEA;IAEA;IACA;MACA;QACA;UACAA;UACAN;UACA;QACA;;QACA;QACA;UACA;YACAO;UACA;QACA,OACA;UAAAA;QAAA;MACA;QACAJ;MACA;IACA;EACA;EACAK;IACA;EACA;AACA","names":["name","data","employeeId","methods","video","console","captureAndProcessImage","context","base64Image","alert","mounted"],"sourceRoot":"src/views/face","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div class=\"camera\">\r\n    <video ref=\"video\" width=\"640\" height=\"480\" autoplay></video>\r\n    <button @click=\"captureAndProcessImage\">拍照并处理</button>\r\n    <canvas ref=\"canvas\" width=\"640\" height=\"480\" style=\"display: none;\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"CameraComponent\",\r\n  data(){\r\n    return {\r\n      employeeId: window.sessionStorage.getItem(\"userId\")\r\n    }\r\n  },\r\n  methods: {\r\n    async setupCamera() {\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n        this.$refs.video.srcObject = stream;\r\n      } catch (error) {\r\n        console.error('Error accessing the camera:', error);\r\n      }\r\n    },\r\n    captureAndProcessImage() {\r\n      const canvas = this.$refs.canvas;\r\n      const context = canvas.getContext('2d');\r\n      const video = this.$refs.video;\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      // 将图像转换为Base64编码的字符串\r\n      let base64Image = canvas.toDataURL('image/png');\r\n      // 去除Base64字符串中的前缀\r\n      base64Image = base64Image.replace(/^data:image\\/png;base64,/, '');\r\n      //console.log(base64Image); // 打印到控制台或发送到后端\r\n\r\n      this.sendImageToBackend(base64Image);\r\n\r\n    },\r\n    async sendImageToBackend(base64Image) {\r\n      try {\r\n        const payload = {\r\n          base64Image: base64Image,\r\n          employeeId: this.employeeId,\r\n          // 可以添加其他需要的数据\r\n        };\r\n        const response = await this.$http.post('/image/upload-image', payload);\r\n        if(response.data.status === 'fail'){\r\n          if(response.data.msg === 'No face detected in the image.'){\r\n            alert(\"未检测到人脸，请重新拍照！\");\r\n          }\r\n        }\r\n        else {alert(\"上传成功！\")}\r\n      } catch (error) {\r\n        console.error('Error sending the image to backend:', error);\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.setupCamera();\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.camera {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n</style>\r\n"]}]}