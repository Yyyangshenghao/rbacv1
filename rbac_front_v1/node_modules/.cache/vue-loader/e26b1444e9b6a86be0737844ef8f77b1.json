{"remainingRequest":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\src\\views\\face\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\src\\views\\face\\index.vue","mtime":1705145088986},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1705038908307},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\babel-loader\\lib\\index.js","mtime":1705038907812},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1705038908307},{"path":"E:\\IDEA CODE\\rbacv1\\rbac_front_v1\\node_modules\\vue-loader\\lib\\index.js","mtime":1705038915248}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJDYW1lcmFDb21wb25lbnQiLA0KICBkYXRhKCl7DQogICAgcmV0dXJuIHsNCiAgICAgIGVtcGxveWVlSWQ6IHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJ1c2VySWQiKQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGFzeW5jIHNldHVwQ2FtZXJhKCkgew0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoeyB2aWRlbzogdHJ1ZSB9KTsNCiAgICAgICAgdGhpcy4kcmVmcy52aWRlby5zcmNPYmplY3QgPSBzdHJlYW07DQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhY2Nlc3NpbmcgdGhlIGNhbWVyYTonLCBlcnJvcik7DQogICAgICB9DQogICAgfSwNCiAgICBjYXB0dXJlQW5kUHJvY2Vzc0ltYWdlKCkgew0KICAgICAgY29uc3QgY2FudmFzID0gdGhpcy4kcmVmcy5jYW52YXM7DQogICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgICBjb25zdCB2aWRlbyA9IHRoaXMuJHJlZnMudmlkZW87DQogICAgICBjb250ZXh0LmRyYXdJbWFnZSh2aWRlbywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsNCg0KICAgICAgLy8g5bCG5Zu+5YOP6L2s5o2i5Li6QmFzZTY057yW56CB55qE5a2X56ym5LiyDQogICAgICBsZXQgYmFzZTY0SW1hZ2UgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTsNCiAgICAgIC8vIOWOu+mZpEJhc2U2NOWtl+espuS4suS4reeahOWJjee8gA0KICAgICAgYmFzZTY0SW1hZ2UgPSBiYXNlNjRJbWFnZS5yZXBsYWNlKC9eZGF0YTppbWFnZVwvcG5nO2Jhc2U2NCwvLCAnJyk7DQogICAgICAvL2NvbnNvbGUubG9nKGJhc2U2NEltYWdlKTsgLy8g5omT5Y2w5Yiw5o6n5Yi25Y+w5oiW5Y+R6YCB5Yiw5ZCO56uvDQoNCiAgICAgIHRoaXMuc2VuZEltYWdlVG9CYWNrZW5kKGJhc2U2NEltYWdlKTsNCg0KICAgIH0sDQogICAgYXN5bmMgc2VuZEltYWdlVG9CYWNrZW5kKGJhc2U2NEltYWdlKSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCBwYXlsb2FkID0gew0KICAgICAgICAgIGJhc2U2NEltYWdlOiBiYXNlNjRJbWFnZSwNCiAgICAgICAgICBlbXBsb3llZUlkOiB0aGlzLmVtcGxveWVlSWQsDQogICAgICAgICAgLy8g5Y+v5Lul5re75Yqg5YW25LuW6ZyA6KaB55qE5pWw5o2uDQogICAgICAgIH07DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kaHR0cC5wb3N0KCcvaW1hZ2UvdXBsb2FkLWltYWdlJywgcGF5bG9hZCk7DQogICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAnZmFpbCcpew0KICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubXNnID09PSAnTm8gZmFjZSBkZXRlY3RlZCBpbiB0aGUgaW1hZ2UuJyl7DQogICAgICAgICAgICBhbGVydCgi5pyq5qOA5rWL5Yiw5Lq66IS477yM6K+36YeN5paw5ouN54Wn77yBIik7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Uge2FsZXJ0KCLkuIrkvKDmiJDlip/vvIEiKX0NCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgdGhlIGltYWdlIHRvIGJhY2tlbmQ6JywgZXJyb3IpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLnNldHVwQ2FtZXJhKCk7DQogIH0NCn07DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/face","sourcesContent":["<template>\r\n  <div class=\"camera\">\r\n    <video ref=\"video\" width=\"640\" height=\"480\" autoplay></video>\r\n    <button @click=\"captureAndProcessImage\">拍照并处理</button>\r\n    <canvas ref=\"canvas\" width=\"640\" height=\"480\" style=\"display: none;\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"CameraComponent\",\r\n  data(){\r\n    return {\r\n      employeeId: window.sessionStorage.getItem(\"userId\")\r\n    }\r\n  },\r\n  methods: {\r\n    async setupCamera() {\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n        this.$refs.video.srcObject = stream;\r\n      } catch (error) {\r\n        console.error('Error accessing the camera:', error);\r\n      }\r\n    },\r\n    captureAndProcessImage() {\r\n      const canvas = this.$refs.canvas;\r\n      const context = canvas.getContext('2d');\r\n      const video = this.$refs.video;\r\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      // 将图像转换为Base64编码的字符串\r\n      let base64Image = canvas.toDataURL('image/png');\r\n      // 去除Base64字符串中的前缀\r\n      base64Image = base64Image.replace(/^data:image\\/png;base64,/, '');\r\n      //console.log(base64Image); // 打印到控制台或发送到后端\r\n\r\n      this.sendImageToBackend(base64Image);\r\n\r\n    },\r\n    async sendImageToBackend(base64Image) {\r\n      try {\r\n        const payload = {\r\n          base64Image: base64Image,\r\n          employeeId: this.employeeId,\r\n          // 可以添加其他需要的数据\r\n        };\r\n        const response = await this.$http.post('/image/upload-image', payload);\r\n        if(response.data.status === 'fail'){\r\n          if(response.data.msg === 'No face detected in the image.'){\r\n            alert(\"未检测到人脸，请重新拍照！\");\r\n          }\r\n        }\r\n        else {alert(\"上传成功！\")}\r\n      } catch (error) {\r\n        console.error('Error sending the image to backend:', error);\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.setupCamera();\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.camera {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n</style>\r\n"]}]}